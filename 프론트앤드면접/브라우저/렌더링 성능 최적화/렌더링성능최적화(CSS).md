# Reflow 비용 줄이기

## Reflow이 언제 발생할까 ?

- Dom Node들이 추가되거나 삭제되거나 위치가 변경될떄 발생한다 (Dom Api 사용)
- window 사이즈 변경 시도시 발생

## Reflow 비용 발생시 성능이 왜 안좋아질까?

- 렌더트리를 다시 생성하게 하게되어 DOM트리와 CSSOM트리를 재구성하여 뷰포트에 맞게 다시 계산
- cpu에서 연산을 처리하여 비용이 커짐

## Reflow를 발생시키는 CSS 속성

- top,left,right,bottm 등 노드의 크기나 위치변화에 관련되어있다

## Reflow개선을 시키는 방법? (CSS요소)

- display: none이 아닌 visibility속성사용
- cssText를 이용해서 한번에 style 변경
- 애니메이션 동작 처리시 left/top 보다는 transform:translate 속성을 사용 (CSS트리거에서 webkit과 익스플로러에서는 리플로우부터 처리하긴함)

  - why ? : 기존의 레이어를 분리시켜서 동작하고 composite스레드에서 동작하여 메인스레드에 영향안줌
  - composite: 기존의레이어와 분리된 레이어를 합성해야하는 장점 존재

- 상위 노드 안에 중첩된 하위 노드가 있을떄 하위노드를 변경

  - 상위노드를 변경하면 하위 요소들 전부 Reflow에 영향끼침

- CSS 하위 선택자를 최소화
- 애니메이션 효과에서 불필요한 프레임을 줄이면 되지만 60fps 미만이 되면 애니메이션 효과의 부드러움은 사라질수있음

# Repaint 비용 줄이기 (CSS요소)

- show/hide 사용하지 않고 opacity를 사용 (opcaity값이 1이면 reflow발생하므로 1보다 작아야함)

## 레이아웃 스레싱 해결 (중요)

- DOM을 변경하지 않고 DOM 엘리먼트 속성을 읽기만해도 처음부터 렌더링한다 (레이아웃 스레싱)
  - 읽는 속성을 캐싱하여 한번에 변경시키면 해결함

## CSS will-change 속성 사용 (성능최적화)

- 브라우저에 별도의 레이어 변화를 힌트 줘서 렌더링하는데 성능을 개선
- 단 더이상 최적화 할 필요가 없어진다면 종료시켜야한다.

## JS 애니메이션 메소드인 requestAnimationframe 사용

- 60fps를 보장하며 애니메이션을 그릴수밖에없게 됨
- 단점은 메인스레드에서 실행되어 콜스택에 많은 작업이 쌓일떄 처리가 불가능해짐

## css import 하지말기

- @import로 css가져오면 병렬로 다운로드를 하지 못하기 떄문에 cssom트리 구성이 지연되는경우가있음 그래서 link 속성 추천

## <script> 태그에 defer붙이기

- defer를 붙이면 여러 js파일을 백그라운드에서 다운받은뒤 html파싱이 완료된후 실행이됨
